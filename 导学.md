# 导学

同学们大家好，经过一个较为长期的准备，React 源码解析工作终于完成，现在为大家带来源码解析的课程。首先我来回答大部分同学们心中的一个问题：我又不写框架，为什么要学他的源代码呢？

- 首先。如果你是 React 的使用者，从业务能力来说，学习源代码毫无疑问会为你带来很大的提升。他能帮助你更好得理解你写的代码是如何运行得；能在你遇到 bug 的时候从底层思考来解决问题；并且能够让你在开始项目之前就能用更好的方式来完成架构。
- 其次。React 源码的很多设计细节都是非常高明的，学习源码能有助于你提升整体的编码能力。开源框架是集合全世界最优秀的一批程序员经过长年累月维护的代码，代码质量完全可以代表业界最高水准，学习框架代码并不是单纯为了理解他的运行流程，更多的是去思考写代码的细节，一些问题有多种方式解决，为什么他们最终选择这种方式，有什么优势，又会带来什么问题，以此来开阔自己的眼界，提升自己的整体能力。
- 再者。互联网寒冬将至，前端岗位的竞争也会越来越大，很多公司招聘都需要精通某个技能。而 React 又是国内使用率最高的，特别受到大公司的偏爱。掌握 React 的源码，毫无疑问将大大提升你的竞争力，成为你升值加薪的竞争基础。

说完了为什么要学习源码，我们再来聊一聊 React。React 是怎么样一个框架呢？

- 非常纯粹。他是一个`UI=fn(x)`的框架，通过`state`映射 UI 的方式来屏蔽了 DOM 操作。现在业界的框架大多如此，但是说 React 纯粹是因为他的 API 设计也非常纯粹，核心 API`setState`，其余所有内容都围绕着组件化来设计，没有`directive`，没有双向绑定，你要改变一个 UI 只能通过`setState`来改变对应的状态，这就给了 React 无比纯粹的开发体验，一切基于组件。
- 思想超前。不知道同学们了不了解 React16 更新了什么，16 版本 React 是完全重写的核心代码，但是对于使用者来说是毫无感知的，这一点就非常优秀，不像 Vue 和 Angular 更新大版本就需要调整兼容。但是更优秀的在于 React16 中引入了`Fiber`来从根本上解决了 JS 单线程运行如果计算事件太长导致动画和交互卡帧的问题，Fiber 的引入可以说是业界领先的，其他的框架可能会陆续跟进。

聊完了 React 我们再来讲讲这门课的内容。

- 核心毫无疑问是 React 的源码实现。但是会分优先级，因为 React 的源码是非常大的，最长的一个文件有 2 万多行代码，在这里我不会每一行代码都跟你们讲解，相信你们也没有这个耐心听。在课程中我会着重讲解：`Fiber`，`Scheduler`，`Update`这些核心内容，这里主要包含了从调用`ReactDOM.render`或者`setState`创建更新开始，到计算更新形成`Fiber`树结构，到最后根据实际需要更新的节点输出新的 DOM 的过程。而在这个过程中，会弱化一些内容的讲解，比如：DOM 操作相关的代码，事件绑定相关的代码。因为这些是平时开发时较为常见的功能，就不在课程中占用过多的事件了，我相信能来学习这门课的同学，应付这些基础知识应该问题不大。
- 讲课方式以直接讲解代码为主，辅以结构图或者流程图，并且对于一些特定功能会运行代码进行调试。源码解析的课程不像做项目的课程，更重要的在于理解而不是学会怎么用。谈到理解就不得不说你只弄清楚了一块代码的一种走向情况并不是理解，你需要考虑到各种各样的情况才能称之为读懂，这也是考量你是否能够参与维护这个项目的标准之一。另外因为 React16 之后增加了`ConcurrentMode`，也就是你调用`setState`之后其实他是一个异步的更新过程而不是同步的，所以这些功能更难调试，即便调试了还是很难看懂，所以对于这种情况，我选择以画图进行总结，用一种总体视角更清晰的方式来进行讲解，而不是走流程的方式。

<del>

### warning

讲了这么多学习这门课的好处之后，我要给各位同学先泼一个冷水了。学习这门课是非常难的，课程内容是总结后的内容，我会根据不同的模块来区分课程章节，并且把不同的函数区分开来讲，尽量让同学们不一次接受太多的新概念。但是从总体上来讲，你是无法逃避新概念的，如果你跟着 React 的`setState`流程走，不超过三个函数调用，你就接触到了：`FiberRoot`，`Fiber`，`Update`，`UpdateQueue`，`expirationTime`等概念，你不能指望你一看到他就知道他的作用。当然在我的课程里，我会在遇到概念的时候就跟你讲解，并且在后续再次用到的时候提醒你。但课程就是工具，工具做得再好，任然需要学的人花精力去思考。毕竟世界上好的书那么多，如果一看就懂，那就不会有中高低级的区分了。

说了这么多，我到底想说什么呢？那就是学习这门课你可能看视频就需要花上大半个月一个月，但这只是开头，你需要自己再去研究源码，写 demo 运行，调试，再回过头来看，再继续思考，循环往复多次，每一次你都会比上一次发现更多的细节。第一遍源码我花了大概一星期就通读完了，后续我想要写总结于是一边看一边写，又发现了很多细节。再后来我对于不太理解的内容再次阅读，终于发现我一开始的理解是错误。再到现在我准备课程的时候，又陆陆续续发现了一些之前没有注意的细节。

所以不要指望你学完这门课你就完全懂了 React 的核心原理，这门课是帮助你：

- 更快理解
- 避免一些错误的理解和方向
- 提供你整体的思考方式，不需要纠结于某个小细节很久。

</del>

### 如何进行学习

注意，要学好这一门课并不简单，你需要：

##### 足够的耐心

看源码不是一朝一夕的事情，React 使用`Fiber`重写前后花了 3 年，你不能期望 3 个星期就完全理解全世界最好的开发者花了三年完成的框架。毫无疑问这是一个循序渐进的过程，我对核心代码前后大概有看过 10 多次，每次都会有新的收获，所以足够的耐心毫无疑问会为你带来更多的收获。

##### 思考再思考

阅读源码不是看小说，代码是不会用大白话告诉你他为什么这么写的，对于一句你不是很理解的代码，你必须去思考，去猜测他的作用。不论你的猜测是否正确，一旦你有了想法，你就可以去验证他，去写 demo 跑起来看是否符合你的预期。重复此步骤，知道你完全理解。

##### 善于提问

在接触一个新事物之前，最大的困难不是不理解，而是不知道。比如对于`Fiber`这个概念，如果你不知道，那么你完全不会对他产生任何疑问。只有知道了这个东西，你开始想要理解他的时候，你才会产生各种疑问。所以在学习过程中，如果你看到了之前没见过的内容，对于你无法理解的点要善于提问，可以在问答区向我提问，可以同学们互相交流，不要留着问题不解决，这是学习的最大误区。另外笔记也是非常重要的，因为再记笔记的过程中你需要一行行代码去解析，能够帮助你发现很多细节。
